@{
    ViewBag.Title = "Kart";
    Layout = "~/Views/_ana.cshtml";
}
@using UniStaj
@using UniStaj.veri
@model UniStaj.Models.StajBirimAsamasiModel

<form id="formKayit" name="formKayit" autocomplete="off">
@{
    int dilKimlik = Model.gecerliDil();
}

<table class="@Ayar.tabloBicim1">
    <thead>
        <tr>
            <th>Staj Aşaması</th>
            <th>Sırası</th>
            <th>Geçerli Mi</th>
            <th>Açıklama</th>
        </tr>
    </thead>
    <tbody>
    @for (int i = 0; i < Model.dokumVerisi.Count; i++)
    {
        var siradaki = Model.dokumVerisi[i];
        <tr>
            <td>
                @siradaki.StajAsamasiAdi
            </td>

            <td>
                @Html.TextBox(
                    "dokumVerisi[{i}].sirasi",
                    siradaki.sirasi,
                    new {
                        @class = Ayar.textBoxBicim(),
                        placeholder = "Sırası"
                    })
            </td>

            <td>
                @Html.TextBox(
                    $"dokumVerisi[{i}].gecerliMi",
                    siradaki.gecerliMi,
                    new {
                        @class = Ayar.textBoxBicim(),
                        placeholder = "Evet / Hayır"
                    })
            </td>

            <td>
                @Html.TextBox(
                    $"dokumVerisi[{i}].aciklama",
                    siradaki.aciklama,
                    new {
                        @class = Ayar.textBoxBicim(),
                        placeholder = "Ek Açıklama"
                    })
            </td>

            @Html.Hidden(
                $"dokumVerisi[{i}].stajBirimAsamasikimlik",
                siradaki.stajBirimAsamasikimlik
            )
        </tr>
    }
    </tbody>
</table>

<button class="@Ayar.btnEkle" onclick="kaydet(); return false;">
    Kaydet
</button>
</form>

<script>
function kaydet() {
    var valdata = $("#formKayit").serialize();

    $.ajax({
        url: "/StajBirimi/turleriKaydet/",
        type: "POST",
        data: valdata,
        contentType: "application/x-www-form-urlencoded; charset=UTF-8",
        dataType: "json",
        success: function (response) {

            if (!response.success) {
                Swal.fire(
                    '@Ayar.sozcuk("Hata", dilKimlik)',
                    response.message,
                    'error'
                );
                return;
            }

            Swal.fire(
                '@Ayar.sozcuk("Başarılı", dilKimlik)',
                response.message,
                'success'
            ).then(function () {

                if (response.yonlensinmi === true) {
                    window.location.href = response.yonlenmeAdresi;
                    return;
                }

                var deger = document.getElementById("yenimi")?.value;
                if (deger === "True") {
                    window.location.reload();
                }
            });
        }
    });
}
</script>
